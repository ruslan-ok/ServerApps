{% extends "base.html" %}
{% load staticfiles %}
{% block content %}

  <script language="javascript" type="text/javascript">

    function getLink(_pk)
    {
      var html = '<a href="/task/' + _pk + '/">' + _pk + '</a>';
      document.write(html);
      return true;
    }

    function myClick(_num)
    {
      var frm = document.getElementById("fld_form");
      var task_active = '0';

      if (frm.elements['active_cbx'].checked)
        task_active = '1';

      frm.elements["active"].value = task_active;
      frm.Submit();
      return true;
    }

    bEdit = false;

    function check()
    {
      var name  = document.getElementById('fld_form').elements['name'].value;

      var status = '';
      if (name == '')
        status = 'Не задано наименование';
      
      document.getElementById('status').innerHTML = status;
      
      var x = document.getElementById('buttons');
      
      if (status != '')
      {
        if (!bEdit)
          x.innerHTML = '';
        else
          x.innerHTML = '<input type="submit" class="LiteButton" id="delete" name="action" value="Удалить"  onClick="myClick(3)"  />' +
                        '<input type="submit" class="LiteButton" id="common" name="action" value="Отменить" onClick="myClick(4)"  />';
      }                                                                                                                          
      else                                                                                                                       
      {                                                                                                                          
        if (!bEdit)                                                                                                              
          x.innerHTML = '<input type="submit" class="LiteButton" id="update" name="action" value="Добавить" onClick="myClick(1)"  />';
        else                                                                                                                     
          x.innerHTML = '<input type="submit" class="LiteButton" id="update" name="action" value="Сохранить"onClick="myClick(2)"  />' +
                        '<input type="submit" class="LiteButton" id="delete" name="action" value="Удалить"  onClick="myClick(3)"  />' +
                        '<input type="submit" class="LiteButton" id="common" name="action" value="Отменить" onClick="myClick(4)"  />';
      }
    }

  </script>
  
  <div id="gmenu" class="menu"> <a href="/">{{ app_text }}</a> </div> <br/>

  <div class="PageTitle">   {{ page_title }}        </div>
  <div class="PageSummary"> {{ task_summary|safe }} </div>

  {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

  <!--DEBUG: {{ debg }}<br>-->
  
  {{ form.non_field_errors }}
  {% for field in form %}
    {% if field.errors %}
      <div class="fieldWrapper"> {{ field.label }} {{ field.errors }} </div>
    {% endif %}
  {% endfor %}

  <form id="fld_form" action="{% url 'task:task_edit' pid %}" method="post">
    {% csrf_token %}
    <input name="active" type="hidden" value="{{ form.active.value }}" />
    <table class="fl1">
      <!--{{ form }}-->
      <tbody>
        {% if pid > 0 %} 
        <script language="javascript" type="text/javascript"> bEdit = true; </script>
        <tr><td class="fl1"> ID: </td><td class="fl2"> {{ pid }} </td> </tr>
        {% else %}
        <script language="javascript" type="text/javascript"> bEdit = false; </script>
        {% endif %} 
        <tr><td class="fl1"> Дата:         </td><td class="fl2"> <input name="date" type="date" onChange="check()" value="{{ form.due_d.value }}" /> </td> </tr>
        <tr><td class="fl1"> Время:        </td><td class="fl2"> <input name="time" type="time" onChange="check()" value="{{ form.due_t.value }}" /> </td> </tr>
        <tr><td class="fl1"> Наименование: </td><td class="fl2"> <input name="name" type="text" onChange="check()" value="{{ form.name.value }}" /> </td> </tr>
        <tr><td class="fl1"> Группа:       </td><td class="fl2"> {{ form.grp }} </td> </tr>
        <tr><td class="fl1"> Активна:      </td><td class="fl2"> <input name="active_cbx" type="checkbox" {% if form.active.value > 0 %} checked {% endif %} onChange="check()" /> </td> </tr>
        <tr><td class="fl1"> Описание:     </td><td class="fl2"> <textarea id="txt" name="comment" rows="3" cols="30" onChange="check()"> {{ form.text.value }} </textarea> </td> </tr>
      </tbody>
    </table>
    <span id="buttons"> </span> 
    <span id="status" class="PageStatus"> </span> 
    <script language="javascript" type="text/javascript"> check() </script>
  </form>


  <table class="work">
    <tbody>
      <tr>
        <th class="work"> ID           </th>
        <th class="work"> Дата         </th>
        <th class="work"> Наименование </th>
      </tr>
      {% for t in tasks %}
      <tr>
        <td class="pid">  <script language="javascript" type="text/javascript">getLink({{ t.id }})</script> </td>
        <td class="work"> {{ t.s_due }} </td>
        <td class="work"> {{ t.name }} </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}

