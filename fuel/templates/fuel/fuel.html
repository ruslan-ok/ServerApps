{% extends "base.html" %}
{% load staticfiles %}
{% block content %}

  <script language="javascript" type="text/javascript">

    function myClick(_num)
    {
      frm.Submit();
      return true;
    }

    function check()
    {
      var frm = document.getElementById("fld_form");
      var pd = new Date(frm.elements['pub_date'].value);
      var odometr = parseInt(frm.elements['odometr'].value);
      var volume = parseFloat(frm.elements['volume'].value);
      var price = parseInt(frm.elements['price'].value);
      
      var status = '';
      
      if (isNaN(pd.getDate()))
        status = 'Не задана дата заправки';
      else
        if (isNaN(odometr))
          status = 'Не задано показание одометра';
        else
          if (isNaN(volume))
            status = 'Не задан объём топлива';
          else
            if (isNaN(price))
              status = 'Не задана цена топлива';

      document.getElementById('status').innerHTML = status;
      
      var x = document.getElementById('buttons');
      
      if (status != '')
      {
        if (!bEdit)
          x.innerHTML = '';
        else
          x.innerHTML = '<input type="submit" class="LiteButton" id="delete" name="action" value="Удалить"   onClick="myClick(3)" />' +
                        '<input type="submit" class="LiteButton" id="common" name="action" value="Отменить"  onClick="myClick(4)" />';
      }
      else
      {
        if (!bEdit)
          x.innerHTML = '<input type="submit" class="LiteButton" id="update" name="action" value="Добавить"  onClick="myClick(1)" />';
        else
          x.innerHTML = '<input type="submit" class="LiteButton" id="update" name="action" value="Сохранить" onClick="myClick(2)" />' +
                        '<input type="submit" class="LiteButton" id="delete" name="action" value="Удалить"   onClick="myClick(3)" />' +
                        '<input type="submit" class="LiteButton" id="common" name="action" value="Отменить"  onClick="myClick(4)" />';
      }
    }

  </script>

  <div id="gmenu" class="menu"> <a href="/">{{ app_text }}</a> | <a href="/fuel/part">{{ part_text }}</a> | <a href="/fuel/cars">{{ car_text }}</a> </div> <br/>

  <div class="PageTitle">   {{ page_title }}   {% for r in cars %} | <a href="/fuel/chg_car/{{ r.id }}/"> {{ r.name }} </a> {% endfor %} </div>
  <div class="PageSummary"> {{ fuel_summary|safe }} </div>
  <div class="PageStatus">  {{ fuel_status }}  </div>

  <form id="fld_form" action="{% url 'fuel:fuel_edit' pid %}" method="post">
    {% csrf_token %}
    <table class="fl1">
      <tbody>
        {% if pid > 0 %} 
        <script language="javascript" type="text/javascript"> bEdit = true; </script>
        <tr><td class="fl1"> ID:      </td><td class="fl2"> {{ pid }} </td> </tr>
        {% else %}
        <script language="javascript" type="text/javascript"> bEdit = false; </script>
        {% endif %}
        <tr><td class="fl1"> Дата:    </td><td class="fl2"> <input name="pub_date" size="10" type="date"   value="{{ form.pub_date.value }}" onChange="check()" /> </td> </tr>
        <tr><td class="fl1"> Одометр: </td><td class="fl2"> <input name="odometr"  size="10" type="number" value="{{ form.odometr.value }}"  onChange="check()" /> </td> </tr>
        <tr><td class="fl1"> Объём:   </td><td class="fl2"> <input name="volume"   size="10" type="text"   value="{{ form.volume.value }}"   onChange="check()" /> </td> </tr>
        <tr><td class="fl1"> Цена:    </td><td class="fl2"> <input name="price"    size="10" type="number" value="{{ form.price.value }}"    onChange="check()" /> </td> </tr>
      </tbody>
    </table>
    <span id="buttons"> </span> 
    <span id="status" class="PageStatus"> </span> 
    <script language="javascript" type="text/javascript"> check() </script>
  </form>

  {% if fuels.count %}
  <table class="work">
    <tbody><tr>
      <th class="work"> ID      </th>
      <th class="work"> Дата    </th>
      <th class="work"> Одометр </th>
      <th class="work"> Объём   </th>
      <th class="work"> Цена    </th>
      <th class="work"> Сумма   </th>
    </tr>
    {% for f in fuels %}
    <tr>
      <td class="pid">  <a href="/fuel/{{ f.id }}/"> {{ f.id }} </a> </td>
      <td class="work"> {{ f.s_pub_date }} </td>
      <td class="numb"> {{ f.odometr }} </td>
      <td class="numb"> {{ f.volume }}  </td>
      <td class="numb"> {{ f.price }}   </td>
      <td class="numb"> {{ f.summ }}    </td>
    </tr>
    {% endfor %}
  </tbody></table>
  {% endif %}

  <br/>Всего заправок: {{ fuels_count }}<br/>

{% endblock %}
