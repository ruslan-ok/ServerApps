{% extends "base_sidebar.html" %}
{% load static i18n %}

{% block extrastyle %}
  <link rel="stylesheet" type="text/css" href="{% static 'todo/css/todo.css' %}">
{% endblock %}

{% block aside_content %}
        <ul class="nav-menu">
          <li class="important{% if cur_view == 'myday' %} selected{% endif %}"><a class="fix" href="{% url 'todo:myday' %}">
              <div class="nav-menu-item-left">
                <img src="{% static 'todo/icon/myday.png' %}">
                {% trans 'my day'|capfirst %}
              </div>
              <div>{{ in_my_day_qty }}</div>
            </a></li>
          <li{% if cur_view == 'important' %} class="selected"{% endif %}><a class="fix" href="{% url 'todo:important' %}">
              <div class="nav-menu-item-left">
                <img src="{% static 'todo/icon/important.png' %}">
                {% trans 'important'|capfirst %}
              </div>
              <div>{{ important_qty }}</div>
            </a></li>
          <li{% if cur_view == 'planned' %} class="selected"{% endif %}><a class="fix" href="{% url 'todo:planned' %}">
              <div class="nav-menu-item-left">
                <img src="{% static 'todo/icon/planned.png' %}">
                {% trans 'planned'|capfirst %}
              </div>
              <div>{{ planned_qty }}</div>
            </a></li>
          <li{% if cur_view == 'all' %} class="selected"{% endif %}><a class="fix" href="{% url 'todo:all_tasks' %}">
              <div class="nav-menu-item-left">
                <img src="{% static 'todo/icon/all.png' %}">
                {% trans 'all'|capfirst %}
              </div>
              <div>{{ all_qty }}</div>
            </a></li>
          <li{% if cur_view == 'completed' %} class="selected"{% endif %}><a class="fix" href="{% url 'todo:completed' %}">
              <div class="nav-menu-item-left">
                <img src="{% static 'todo/icon/completed.png' %}">
                {% trans 'completed'|capfirst %}
              </div>
              <div>{{ completed_qty }}</div>
            </a></li>
        </ul>
        <div class="nav-last-static-list"></div>
        <ul class="nav-menu">
          {% for node in groups %}
            <li class="grp-item">
              {% if node.is_list %}
                <a href="{% url 'todo:list_items' node.id %}">
                  <div class="nav-menu-item-left">
                    <img class="level-{{ node.level }}" src="{% static 'todo/icon/list.png' %}">
                    <div>{{ node.name }}</div>
                  </div>
                </a>
                <div class="nav-menu-item-right">
                  {{ node.qty }}
                </div>
              {% else %}
                <a href="{% url 'todo:group_form' node.id %}">
                  <div class="nav-menu-item-left">
                    <img class="level-{{ node.level }}" src="{% static 'todo/icon/group.png' %}">
                    <div>{{ node.name }}</div>
                  </div>
                </a>
                <div class="nav-menu-item-right">
                  <a href="{% url 'todo:group_toggle' node.id %}">
                    {% if node.is_open %}
                      <img src="{% static 'todo/icon/direct-down.png' %}">
                    {% else %}
                      <img src="{% static 'todo/icon/direct-left.png' %}">
                    {% endif %}
                  </a>
                </div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
        <form method="post" class="grp-actions">{% csrf_token %}
          <button type="submit" name="list-add" class="default lst-add" label="create list"><img src="{% static 'todo/icon/add.png' %}"></button>
          <input type="text" class="add-grp" placeholder="{% trans 'create list or group'|capfirst %}" name="name">
          <button type="submit" name="group-add" class="default grp-add" label="create group"><img src="{% static 'todo/icon/group-add.png' %}"></button>
        </form>
{% endblock %}

{% block content %}
        <div class="top">
          <div class="main-top-headline">
            <div class="main-title-container">
              {{ list_title }}
              {% if list_id %}
                <a href="{% url 'todo:list_form' list_id %}" class="field-icon"><img src="{% static 'rok/icon/edit.png' %}"></a>
              {% endif %}
            </div>
            <div class="main-title-subline">
              {{ list_info|date:'l, j E' }}
            </div>
          </div>
            {% if cur_view != 'planned' %}
            <div class="dropdown">
              <button class="task-list-sort dropbtn" onclick="ShowMenu('sort_menu')">
                <img src="{% static 'todo/icon/sort.png' %}">
                {% trans 'sort'|capfirst %}
              </button>
              <form method="post" class="sort-actions">{% csrf_token %}
                <div class="dropdown-content pos-sort" id="sort_menu">
                  <div class="dropdown-content-title">{% trans 'sort order'|capfirst %}</div>
                  {% if cur_view != 'important' %}
                  <button type="submit" class="dropdown-content-item" name="sort-important"> <img src="{% static 'todo/icon/important.png' %}"> {% trans 'by importance'|capfirst %} </button>
                  {% endif %}
                  <button type="submit" class="dropdown-content-item" name="sort-termin">    <img src="{% static 'todo/icon/planned.png' %}">   {% trans 'by date of completion'|capfirst %} </button>
                  {% if cur_view != 'myday' %}
                  <button type="submit" class="dropdown-content-item" name="sort-myday">     <img src="{% static 'todo/icon/myday.png' %}">     {% trans 'my day'|capfirst %} </button>
                  {% endif %}
                  <button type="submit" class="dropdown-content-item" name="sort-name">      <img src="{% static 'todo/icon/sort.png' %}">      {% trans 'by name'|capfirst %}  </button>
                  <button type="submit" class="dropdown-content-item" name="sort-created">   <img src="{% static 'todo/icon/created.png' %}">   {% trans 'by creation date'|capfirst %}    </button>
                </div>
              </form>
            </div>
            {% endif %}
        </div>
        <div class="sort">
          {% if sort_mode %}
          <form method="post" class="sort-actions sort">{% csrf_token %}
            <button type="submit" name="sort-direction">
              {% if sort_dir %}
                <img src="{% static 'todo/icon/direct-down.png' %}">
              {% else %}
                <img src="{% static 'todo/icon/direct-up.png' %}">
              {% endif %}
            </button>
            <span>{{ sort_mode }}</span>
            <button type="submit" name="sort-delete">
              <img src="{% static 'rok/icon/delete.png' %}">
            </button>
            {% endif %}
          </form>
        </div>
      <form method="post" class="actions">{% csrf_token %}
        <button type="submit" name="task-add" class="default" placeholder="{% trans 'add task'|capfirst %}"><img src="{% static 'todo/icon/add-gray.png' %}"></button>
        <input type="text" class="add-task" placeholder="{% trans 'add task'|capfirst %}" name="task_add-name" maxlength="200" required="" id="id_task_add-name">
      </form>
      <div class="tree">
        {% for term in object_list %}
          {% if term.name %}
          <div class="group">
            <div class="tumbler">V</div>
            <div class="name">{{ term.name }}</div>
          </div>
          {% endif %}
          <ul>
            {% for task in term.todo %}
            <li>
              <a href="{% url 'todo:task_form' task.id %}" class="{% if task.id == task_id %}current{% endif %}">
                <div class="task">
                  <div class="icon">
                    <form method="post">{% csrf_token %}
                      <button type="submit" name="task-in-list-complete" value="{{ task.id }}">
                        {% if task.completed %}
                          <img src="{% static 'todo/icon/complete.png' %}">
                        {% else %}
                          <img src="{% static 'todo/icon/uncomplete.png' %}">
                        {% endif %}
                      </button>
                    </form>
                  </div>
                  <div class="info">
                    <div class="name{% if task.completed %} completed{% endif %}">{{ task.name }}</div>
                    <div class="term{% if task.expired %} expired{% endif %}">{{ task.term }}</div>
                  </div>
                </div>
                <div class="icon">
                  <form method="post">{% csrf_token %}
                    <button type="submit" name="task-in-list-important" value="{{ task.id }}">
                      {% if task.important %}
                        <img src="{% static 'todo/icon/important-on.png' %}">
                      {% else %}
                        <img src="{% static 'todo/icon/important-off.png' %}">
                      {% endif %}
                    </button>
                  </form>
                </div>
              </a></li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
{% endblock %}

{% block article_content %}
    {% if details_mode == 'group' %}
      <form method="post" class="body">{% csrf_token %}
        <div class="fields">
          <div class="header">
            {% if grp_form.errors %}
              <div class="fieldset">
                <p class="errornote"> {% if grp_form.errors.items|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %} </p> 
              </div>
            {% endif %}
            {% if grp_form.non_field_errors %}
              <div class="fieldset">
              {% for error in grp_form.non_field_errors %} <p class="errornote"> {{ error }} </p> {% endfor %}
              </div>
            {% endif %}
            <div class="field-error">{{ grp_form.name.errors }}</div>
            <div class="field-group">
              <div class="field-icon">
                <img src="{% static 'todo/icon/group.png' %}">
              </div>
              <div class="article-name">
                <div class="editable-content main-element">
                  {{ grp_form.name }}
                </div>
              </div>
              <button type="submit" name="group-save"><img src="{% static 'todo/icon/save.png' %}"></button>
            </div>
          </div>
          <div class="section">
            <div class="field-error">{{ grp_form.node.errors }}</div>
            <div class="section-item">
                <div class="section-inner">
                  <div class="section-icon">
                    <img src="{% static 'todo/icon/group.png' %}">
                  </div>
                  {{ grp_form.node }}
                </div>
            </div>
          </div>
          <div class="section">
            <div class="field-error">{{ grp_form.sort.errors }}</div>
            <div class="section-item">
                <div class="section-inner">
                  <div class="section-icon">
                    <img src="{% static 'todo/icon/sort.png' %}">
                  </div>
                  <div class="editable-content auxiliary-element">
                    {{ grp_form.sort }}
                  </div>
                </div>
            </div>
          </div>
        </div>
      </form>
    {% endif %}
    
    {% if details_mode == 'list' %}
      <form method="post" class="body">{% csrf_token %}
        <div class="fields">
          <div class="header">
            {% if lst_form.errors %}
              <div class="fieldset">
                <p class="errornote"> {% if lst_form.errors.items|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %} </p> 
              </div>
            {% endif %}
            {% if lst_form.non_field_errors %}
              <div class="fieldset">
              {% for error in lst_form.non_field_errors %} <p class="errornote"> {{ error }} </p> {% endfor %}
              </div>
            {% endif %}
            <div class="field-error">{{ lst_form.name.errors }}</div>
            <div class="field-group">
              <div class="field-icon">
                <img src="{% static 'todo/icon/list.png' %}">
              </div>
              <div class="article-name">
                <div class="editable-content main-element">
                  {{ lst_form.name }}
                </div>
              </div>
              <button type="submit" name="list-save"><img src="{% static 'todo/icon/save.png' %}"></button>
            </div>
          </div>
          <div class="section">
            <div class="field-error">{{ lst_form.grp.errors }}</div>
            <div class="section-item">
                <div class="section-inner">
                  <div class="section-icon">
                    <img src="{% static 'todo/icon/group.png' %}">
                  </div>
                  {{ lst_form.grp }}
                </div>
            </div>
          </div>
          <div class="section">
            <div class="field-error">{{ lst_form.sort.errors }}</div>
            <div class="section-item">
                <div class="section-inner">
                  <div class="section-icon">
                    <img src="{% static 'todo/icon/sort.png' %}">
                  </div>
                  <div class="editable-content auxiliary-element">
                    {{ lst_form.sort }}
                  </div>
                </div>
            </div>
          </div>
        </div>
      </form>
    {% endif %}

    {% if details_mode == 'task' %}
        <div class="fields">
          <form method="post" class="header">{% csrf_token %}
            {% if form.errors %}
              <div class="fieldset">
                <p class="errornote"> {% if form.errors.items|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %} </p> 
              </div>
            {% endif %}
            {% if form.non_field_errors %}
              <div class="fieldset">
              {% for error in form.non_field_errors %} <p class="errornote"> {{ error }} </p> {% endfor %}
              </div>
            {% endif %}
            <div class="field-error">{{ form.name.errors }}</div>
            <div class="field-group">
              <button type="submit" name="task-completed" class="field-icon">
                {% if completed %}
                  <img src="{% static 'todo/icon/complete.png' %}">
                {% else %}
                  <img src="{% static 'todo/icon/uncomplete.png' %}">
                {% endif %}
              </button>
              <div class="article-name{% if completed %} completed{% endif %}">
                <div class="editable-content main-element">
                  <input type="text" name="task_edit-name" value="{{ form.name.value }}" maxlength="200" required="" id="id_task_edit-name" class="{% if completed %}completed{% endif %}">
                </div>
              </div>
              <button type="submit" name="task-important" class="field-icon">
                {% if important %}
                  <img src="{% static 'todo/icon/important-on.png' %}">
                {% else %}
                  <img src="{% static 'todo/icon/important-off.png' %}">
                {% endif %}
              </button>
              <button type="submit" name="task-save" class="field-icon"><img src="{% static 'todo/icon/save.png' %}"></button>
            </div>
          </form>

          <div class="steps">
            <div class="step-list">
              {% for step in steps %}
                <form method="post">{% csrf_token %}
                  <input type="hidden" name="step_edit_id" value="{{ step.id }}" required="" id="id_step_edit_id">
                  <!--button type="submit" name="step-save" class="default-and-hidden"></button-->
                  <div class="field-error">{{ step.name.errors }}</div>
                  <div class="step-field-group">
                    <button type="submit" name="step-complete" class="field-icon">
                      {% if step.completed %}
                        <img src="{% static 'todo/icon/step-complete.png' %}">
                      {% else %}
                        <img src="{% static 'todo/icon/step-uncomplete.png' %}">
                      {% endif %}
                    </button>
                    <div class="step-name">
                      <div class="editable-content auxiliary-element">
                        <input type="text" name="step_edit_name" value="{{ step.name }}" maxlength="200" required="" id="id_step_edit_name" class="{% if step.completed %}completed{% endif %}">
                      </div>
                    </div>
                    <button type="submit" name="step-save" class="field-icon"><img src="{% static 'todo/icon/save.png' %}"></button>
                    <button type="submit" name="step-delete" class="field-icon"><img src="{% static 'rok/icon/delete.png' %}"></button>
                  </div>
                </form>
              {% endfor %}
            </div>
            <div class="step-add">
              <form method="post">{% csrf_token %}
                <div class="field-error">{{ step_form.name.errors }}</div>
                <div class="step-field-group">
                  <button type="submit" name="step-add" class="field-icon"><img src="{% static 'todo/icon/step-add.png' %}"></button>
                  <div class="step-name">
                    <div class="editable-content auxiliary-element">
                      <input type="text" name="step_add-name" value="{{ step_add_name }}" maxlength="200" required="" placeholder="{% trans 'next step'|capfirst %}" id="id_step_add-name">
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <form method="post" class="body">{% csrf_token %}
            <div class="section">
              <div class="section-item">
                <button type="submit" name="task-myday" class="section-inner-click">
                  <div class="section-inner">
                    <div class="section-icon">
                      <img src="{% static 'todo/icon/myday.png' %}">
                    </div>
                    <div class="section-content">
                      <div class="section-title{% if in_my_day %} selected{% endif %}">
                        {% if in_my_day %}
                          {% trans 'added in "My day"'|capfirst %}
                        {% else %}
                          {% trans 'add to "My day"'|capfirst %}
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </button>
              </div>
            </div>
          
            <div class="section">
              <div class="section-item">
                <button class="section-inner-click">
                  <div class="section-inner">
                    <div class="section-icon">
                      <img src="{% static 'todo/icon/remind.png' %}">
                    </div>
                    <div class="section-content">
                      <div class="section-title">
                        {% trans 'remind'|capfirst %}
                      </div>
                    </div>
                  </div>
                </button>
              </div>
              <div class="section-item dropdown">
                <button class="section-inner-click task-termin dropbtn">
                  <div class="section-inner">
                    <div class="section-icon">
                      <img src="{% static 'todo/icon/planned.png' %}">
                    </div>
                    <div class="section-content">
                      <div class="section-title{% if task_expired %} expired{% elif task_start %} actual{% endif %}">
                        {% if not task_start %}
                          {% trans 'add due date'|capfirst %}
                        {% else %}
                          {{ task_term }}
                        {% endif %}
                      </div>
                    </div>
                    {% if task_start %}
                      <div class="section-icon">
                        <img src="{% static 'rok/icon/delete.png' %}">
                      </div>
                    {% endif %}
                  </div>
                </button>
                <div class="dropdown-content pos-termin">
                  <div class="dropdown-content-title">{% trans 'termin'|capfirst %}</div>
                  <button type="submit" class="dropdown-content-item c001" name="termin-today">
                    <div class="c002">
                      <img src="{% static 'todo/icon/termin-today.png' %}">
                      <span class="c003">{% trans 'today'|capfirst %}</span>
                    </div>
                    <div class="c004">{{ termin_today_info }}</div>
                  </button>
                  <button type="submit" class="dropdown-content-item c001" name="termin-tomorrow">
                    <div class="c002">
                      <img src="{% static 'todo/icon/termin-tomorrow.png' %}">
                      <span class="c003">{% trans 'tomorrow'|capfirst %}</span>
                    </div>
                    <div class="c004">{{ termin_tomorrow_info }}</div>
                  </button>
                  <button type="submit" class="dropdown-content-item c001" name="termin-next-week">
                    <div class="c002">
                      <img src="{% static 'todo/icon/termin-next-week.png' %}">
                      <span class="c003">{% trans 'next week'|capfirst %}</span>
                    </div>
                    <div class="c004">{{ termin_next_week_info }}</div>
                  </button>
                  <div class="dropdown-content-separator"></div>
                  <button type="submit" class="dropdown-content-item c001" name="termin-select">
                    <div class="c002">
                      <img src="{% static 'todo/icon/termin-select.png' %}">
                      <span class="c003">{% trans 'select date'|capfirst %}</span>
                    </div>
                    <img class="c004" src="{% static 'todo/icon/direct-right.png' %}">
                  </button>
                </div>
              </div>
              <div class="section-item">
                <button class="section-inner-click">
                  <div class="section-inner">
                    <div class="section-icon">
                      <img src="{% static 'todo/icon/repeat.png' %}">
                    </div>
                    <div class="section-content">
                      <div class="section-title">
                        {% trans 'repeat'|capfirst %}
                      </div>
                    </div>
                  </div>
                </button>
              </div>
            </div>
          
            <div class="section">
              <div class="section-item">
                <button class="section-inner-click">
                  <div class="section-inner">
                    <div class="section-icon">
                      <img src="{% static 'todo/icon/category.png' %}">
                    </div>
                    <div class="section-content">
                      <div class="section-title">
                        {% trans 'categories'|capfirst %}
                      </div>
                    </div>
                  </div>
                </button>
              </div>
            </div>
          </form>
          
          <div class="section">
            <div class="file-list">
              {% for file in files %}
                <div class="file-item">
                  <a href="{{ file.upload.url }}" class="clickable-item">
                    <div class="thumbnail-wrapper">
                      <div class="thumbnail">{{ file.ext }}</div>
                    </div>
                    <div class="file-content">
                      <div class="file-title">{{ file.name }}</div>
                      <div class="file-metadata">{{ file.size }}</div>
                    </div>
                  </a>
                  <form method="post">{% csrf_token %}
                    <button type="submit" name="task-file-delete" value="{{ file.id }}" class="field-icon"><img src="{% static 'rok/icon/delete.png' %}"></button>
                  </form>
                </div>
              {% endfor %}
            </div>
            <div class="file-add">
              <form method="post" enctype="multipart/form-data" class="section">{% csrf_token %}
                <div class="section-item">
                    <div class="section-inner">
                      <div class="section-icon">
                        <button type="submit" id="id_submit" name="task-file-upload" class="section-inner-click">
                          <img src="{% static 'todo/icon/file.png' %}">
                        </button>
                      </div>
                      <div class="section-content">
                        <div class="section-title">
                          <button id="loadFile" type="button" onclick="UploadFile()">{% trans 'add file'|capfirst %}</button>
                          <input type="file" style="display:none;" id="id_upload" name="upload" onchange="FileSelected()">
                        </div>
                      </div>
                    </div>
                </div>
              </form>
            </div>
          </div>

          <form method="post" class="section">{% csrf_token %}
            <div class="section-item section-item-note">
              <div class="field-error">{{ form_info.info.errors }}</div>
              <div class="section-inner">
                {{ form_info.info }}
                <div class="section-icon">
                  <button type="submit" name="task-info-save" class="field-icon"><img src="{% static 'todo/icon/save.png' %}"></button>
                </div>
              </div>
            </div>
          </form>

          <form method="post" class="section">{% csrf_token %}
            <div class="section-item">
              <div class="field-error">{{ form_lst.lst.errors }}</div>
              <div class="section-52">
                <div class="section-icon">
                  <img src="{% static 'todo/icon/list.png' %}">
                </div>
                <div class="section-content">
                  <div class="section-title">
                    {{ form_lst.lst }}
                  </div>
                </div>
                <div class="section-icon">
                  <button type="submit" name="task-lst-save" class="field-icon"><img src="{% static 'todo/icon/save.png' %}"></button>
                </div>
              </div>
            </div>
          </form>

        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script>
      function ShowMenu(menu_id) {
        if (document.getElementById(menu_id).style.display == "block")
          document.getElementById(menu_id).style.display = "none";
        else
          document.getElementById(menu_id).style.display = "block";
      }

      function UploadFile() {
        document.getElementById('id_upload').click();
      }
      
      function FileSelected() {
        document.getElementById('loadFile').innerText = document.getElementById('id_upload').files[0].name;
      }
  </script>
{% endblock %}


