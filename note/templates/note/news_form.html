{% extends "note/news_list.html" %}
{% load static i18n %}

{% block article_info %}
  {{ item_info }}
{% endblock %}

{% block article_content %}
  <div class="fields">
    <form method="post" enctype="multipart/form-data">{% csrf_token %}

      <!-- Form Errors -->
      {% if form.errors %}
        <div class="fieldset">
          <p class="errornote"> {% if form.errors.items|length == 1 %}{{ please_correct_one }}{% else %}{{ please_correct_all }}{% endif %} </p> 
        </div>
      {% endif %}
      {% if form.non_field_errors %}
        <div class="fieldset">
        {% for error in form.non_field_errors %} <p class="errornote"> {{ error }} </p> {% endfor %}
        </div>
      {% endif %}

      <!-- Note.name -->
      <div class="header">
        <button type="hidden" name="item-save" id="id_item_save"></button>
        <div class="row">
          {{ form.name.label_tag }}
        </div>
        {% if form.name.errors %}
          <div class="row">
            <div class="field-error">{{ form.name.errors }}</div>
          </div>
        {% endif %}
        <div class="row editable-content full-width main-element">
          <!--div class="field-icon">
            <img src="{% static 'todo/icon/uncomplete.png' %}">
          </div-->
          {{ form.name }}
          <button type="submit" name="item-save" class="field-icon"><img src="{% static 'rok/icon/save.png' %}"></button>
        </div>
      </div>

      <div class="body">
        <div class="section">
          <!-- Note.descr -->
          <div class="section-item">
            <div class="section-inner">
              <div class="field-error">{{ form.descr.errors }}</div>
              <div class="editable-content full-width">
                <div class="labeled-input">
                  <div class="label">{{ form.descr.label_tag }}</div>
                  <div class="input">{{ form.descr }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Note.url -->
          {% if form.url.errors %}
            <div class="row">
              <div class="field-error">{{ form.url.errors }}</div>
            </div>
          {% endif %}
          <div class="row">
            <div class="label">{{ form.url.label_tag }}</div>
            {% if form.url.value %}
              <input type="hidden" name="url" value="{{ form.url.value }}" id="id_url">
              <a href="{{ form.url.value }}">{{ form.url.value }}</a>
              <button type="submit" name="url-delete" class="field-icon"><img src="{% static 'rok/icon/delete.png' %}"></button>
            {% else %}
              <div class="input">{{ form.url }}</div>
            {% endif %}
          </div>

          <!-- Note.lst -->
          {% if form.lst.errors %}
            <div class="field-error">{{ form.lst.errors }}</div>
          {% endif %}
          <div class="row">
            <div class="label">{{ form.lst.label_tag }}</div>
            <div class="input">{{ form.lst }}</div>
          </div>
        </div> <!-- section -->

        <div class="section">
          <!-- Note.publ -->
          {% if form.publ.errors %}
            <div class="row">
              <div class="field-error">{{ form.publ.errors }}</div>
            </div>
          {% endif %}
          <div class="row">
            {{ form.publ.label_tag }}
          </div>
          <div class="row" id="id_publ_view">
            <div class="full-width">{{ form.publ.value|date:'d.m.Y G:i' }}</div>
            <div class="button field-icon" id="id_edit" onclick="OpenPublEdit()"><img src="{% static 'rok/icon/edit.png' %}"></div>
          </div>
          <div class="row" id="id_publ_edit">
            {{ form.publ }}
          </div>
        </div> <!-- section -->

        <div class="section">
          <!-- Note.categories -->
          <div class="row">
            {{ form.category.label_tag }}
          </div>
          <div class="row">
            {% if categories %}
              <button type="hidden" name="category-delete" id="id_category_delete" value="???"></button>
              <div class="categories">
                {% for categ in categories %}
                  <div class="category category-design-{{ categ.design }}">
                    <div class="label">
                      <div class="value">
                        {{ categ.name }}
                      </div>
                    </div>
                    <div class="icon" onclick="CategoryDelete('{{categ.name}}')">
                    <div class="delete">
                      <svg height="8" width="8" style="fill: currentcolor;">
                        <path d="M4.46607 4L8 7.53905L7.53905 8L4 4.46607L0.460948 8L0 7.53905L3.53393 4L0 0.460948L0.460948 0L4 3.53393L7.53905 0L8 0.460948L4.46607 4Z"></path>
                      </svg>
                    </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
          {% if form.category.errors %}
          <div class="row">
            <div class="field-error">{{ form.category.errors }}</div>
          </div>
          {% endif %}
          <div class="row">
            <div class="section-icon">
              <img src="{% static 'todo/icon/category.png' %}">
            </div>
            {{ form.category }}
          </div>

        </div> <!-- section -->
  
        <div class="section">
          <!-- file-list -->
          <div class="file-list">
            {% for file in files %}
              <div class="file-item">
                <a href="{{ file.url }}" class="clickable-item">
                  <div class="thumbnail-wrapper" style="background-color: {{ file.design }}">
                    <div class="thumbnail">{{ file.ext }}</div>
                  </div>
                  <div class="file-content">
                    <div class="file-title">{{ file.name }}</div>
                    <div class="file-metadata">{{ file.sizeof_fmt }}</div>
                  </div>
                </a>
                <button type="submit" name="file-delete" value="{{ file.id }}" class="field-icon"><img src="{% static 'rok/icon/delete.png' %}"></button>
              </div>
            {% endfor %}
          </div> <!-- file-list -->
  
          <!-- file-add -->
          <div class="file-add">
            <div class="section-item">
              <button type="button" name="file-upload" class="section-inner-click">
                <div class="section-inner">
                  <div class="section-icon">
                    <img src="{% static 'todo/icon/file.png' %}">
                  </div>
                  <div class="section-content">
                    <div class="section-title">
                      <div id="loadFile" type="button" onclick="UploadFile()">{% trans 'add file'|capfirst %}</div>
                      <input type="file" style="display:none;" id="id_upload" name="upload" onchange="FileSelected()">
                    </div>
                  </div>
                </div>
              </button>
              <button type="submit" id="id_submit" name="file-upload"></button>
            </div>
          </div> <!-- file-add -->
        </div> <!-- section -->

      </div> <!-- body -->
    </form>
  </div>
{% endblock %}


{% block scripts %}
  {{ block.super }}
  <script>
    document.getElementById('id_publ_edit').style.display = "none";
    AddAutoResize();

    function OpenPublEdit()
    {
      document.getElementById('id_publ_view').style.display = "none";
      document.getElementById('id_publ_edit').style.display = "block";
    }

    function AddAutoResize()
    {
      document.querySelectorAll('[data-autoresize]').forEach(function (element) {
      element.style.boxSizing = 'border-box';
      var offset = element.offsetHeight - element.clientHeight;
      element.addEventListener('input', function (event) {
        event.target.style.height = 'auto';
        event.target.style.height = event.target.scrollHeight + offset + 'px';});
      element.removeAttribute('data-autoresize');});

      element = document.getElementById('id_descr');
      element.style.minHeight = "25px";
      element.style.height = (element.scrollHeight + element.offsetHeight - element.clientHeight)+"px";
    }

    function CategoryDelete(_category)
    {
      element = document.getElementById('id_category_delete');
      element.value = _category;
      element.click();
    }

    function UploadFile()
    {
      document.getElementById('id_upload').click();
    }

    function FileSelected()
    {
      document.getElementById('loadFile').innerText = document.getElementById('id_upload').files[0].name;
      document.getElementById('id_submit').click();
    }

  </script>
{% endblock %}


