{% extends "base/item_detail.html" %}
{% load static i18n %}

{% block extrastyle %}
  {{ block.super }}
  <link href="{% static 'css/apart.min.css' %}" rel="stylesheet">
{% endblock %}

{% block item_detail %}
    <div class="row mb-3" name="period_date_rate">
      {{ form.start.errors }} {{ form.start }}
      {{ form.bill_residents.errors }} {{ form.bill_residents }}
    </div>

    <ul class="nav nav-tabs" id="billTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="meter-tab" data-bs-toggle="tab" data-bs-target="#meter-tab-pane" type="button" role="tab" aria-controls="meter-tab-pane" aria-selected="true">Счетчики {{ apart_period_meters|length }}</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="service-tab" data-bs-toggle="tab" data-bs-target="#service-tab-pane" type="button" role="tab" aria-controls="service-tab-pane" aria-selected="false">Услуги {{ apart_period_services|length }}</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="attach-tab" data-bs-toggle="tab" data-bs-target="#attach-tab-pane" type="button" role="tab" aria-controls="attach-tab-pane" aria-selected="false">Вложения {{ files|length }}</button>
      </li>
    </ul>
    <div class="tab-content" id="billTabContent">
      <div class="tab-pane fade" id="meter-tab-pane" role="tabpanel" aria-labelledby="meter-tab" tabindex="0">
        <table class="table table-light">
          <thead>
            <tr>
              <th scope="col">Ресурс</th>
              <th scope="col">Предыдущее</th>
              <th scope="col">Текущее</th>
              <th scope="col">Использовано</th>
            </tr>
          </thead>
          <tbody>
            {% for meter in apart_period_meters %}
              <tr>
                <td scope="row">{{ meter.name }}</td>
                <td>{{ meter.prev_value }}</td>
                <td>{{ meter.curr_value }}</td>
                <td>{{ meter.value }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="tab-pane fade show active" id="service-tab-pane" role="tabpanel" aria-labelledby="service-tab" tabindex="0">
        <table class="table table-light">
          <thead>
            <tr>
              <th scope="col">Сервис</th>
              <th scope="col">Тариф</th>
              <th scope="col">Начислено</th>
              <th scope="col">Оплачено</th>
              <th scope="col">Дата оплаты</th>
          </tr>
          </thead>
          <tbody>
            {% for service in apart_period_services %}
              <tr>
                <td scope="row">{{ service.get_apart_service_name }}</td>
                <td>{{ service.get_apart_service_tarif|default_if_none:"" }}</td>
                <td>{{ service.get_apart_service_accrued|default_if_none:"" }}</td>
                <td>{{ service.get_apart_service_payment|default_if_none:"" }}</td>
                <td>{{ service.event|date:"d M Y" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="row">
          <div class="col">
            <a href="#" class="mx-3 float-end"  data-bs-toggle="modal" data-bs-target="#addProperty" data-bs-whatever="@fat">Добавить</a>
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="attach-tab-pane" role="tabpanel" aria-labelledby="attach-tab" tabindex="0">
        {{ form.upload }}
      </div>
  </div>

  {{ form.info.label_tag }} {{ form.info }} 
  {{ form.url.label_tag }} {{ form.url }}

  {% include "widgets/url_list.html" %}
  {% include "widgets/attachments.html" %}

{% endblock %}

{% block footer_detail %}
  {{ block.super }}

  <div class="modal fade" id="addProperty" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Новый атрибут</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="is-select-prop" class="col-form-label">Наименование</label>
              <select class="form-select" id="is-select-prop">
                <option selected>... выбор атрибута ...</option>
                {% for prop in all_properties %}
                  <option value="{{ prop.code }}">{{ prop.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label for="id_date_from" class="col-form-label">Дата с:</label>
              <input type="date" name="date_from" class="form-control" id="id_date_from" value=""">
            </div>
            <div class="mb-3">
              <label for="id_date_until" class="col-until-label">Дата по:</label>
              <input type="date" name="date_until" class="form-control" id="id_date_until" value=""">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
          <button type="button" class="btn btn-primary">Добавить</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extrascript %}
  {{ block.super }}
  <script src="{% static 'js/apart.js' %}"></script>
{% endblock %}

